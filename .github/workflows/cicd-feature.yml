name: cicd-feature

on:
  push:
    branches:
      - feature/*
      - issue/*
      - bugfix/*

jobs:
  check_open_pr:
    name: Check open PR
    runs-on: ubuntu-latest
    outputs:
      open_pr_found: ${{ steps.PR.outputs.pr_found }}
    steps:
      # Get open (non-draft) PR info.
      - name: Get PR info
        uses: 8BitJonny/gh-get-current-pr@3.0.0
        id: PR
        with:
          filterOutClosed: true
          filterOutDraft: true
      - run: |
          echo "prFound: ${{ steps.PR.outputs.pr_found }}"
          echo "prUrl: ${{ steps.PR.outputs.pr_url }}"
        if: steps.PR.outputs.pr_found == 'true'

  build-and-test:
    needs: check_open_pr
    if: needs.check_open_pr.outputs.open_pr_found == 'true'
    uses: ./.github/workflows/build-and-test.yml
    with:
      runs-on: "['ubuntu-22.04']"
