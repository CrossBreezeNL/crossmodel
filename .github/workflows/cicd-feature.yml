name: cicd-feature

on:
  push:
    branches:
      - feature/*
      - issue/*
      - bugfix/*

jobs:
  check-open-pr:
    name: Check open PR
    runs-on: ubuntu-latest
    outputs:
      open-pr-found: ${{ steps.PR.outputs.prFound }}
    steps:
      # Get open (non-draft) PR info.
      - name: Get PR info
        uses: 8BitJonny/gh-get-current-pr@3.0.0
        id: PR
        with:
          filterOutClosed: true
          filterOutDraft: true
      - run: echo "PR ${prNumber} ${prTitle} at ${prUrl}"
        if: steps.PR.outputs.pr_found == 'true'
        env:
          prFound: ${{ steps.PR.outputs.pr_found }}
          prNumber: ${{ steps.PR.outputs.number }}
          prUrl: ${{ steps.PR.outputs.pr_url }}
          prTitle: ${{ steps.PR.outputs.pr_title }}

  build-and-test:
    needs: check-open-pr
    if: needs.check-open-pr.outputs.open-pr-found == 'true'
    uses: ./.github/workflows/build-and-test.yml
    with:
      runs-on: "['ubuntu-22.04']"
